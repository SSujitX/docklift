name: Test Install - Debian

on:
  push:
    branches: [ master, main ]
  pull_request:
    branches: [ master, main ]
  workflow_dispatch:

jobs:
  test-debian:
    runs-on: ubuntu-latest
    container: debian:stable
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Install Basic Ops
        run: |
          apt-get update
          apt-get install -y curl sudo procps

      - name: Run Install Script
        run: |
          chmod +x install-debian.sh
          sudo DOCKLIFT_CI_LOCAL=true ./install-debian.sh
        env:
          CI: true

      - name: Verify Setup
        run: |
          if [ -d "/opt/docklift" ]; then
            echo "✅ Installation directory exists"
          else
            echo "❌ Installation directory missing"
            exit 1
          fi
          
          if command -v git &> /dev/null; then
            echo "✅ Git was installed"
          else
            echo "❌ Git missing"
            exit 1
          fi
