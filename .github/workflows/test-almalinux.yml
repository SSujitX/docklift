name: Test Install - AlmaLinux

on:
  push:
    branches: [ master, main ]
  pull_request:
    branches: [ master, main ]
  workflow_dispatch:

jobs:
  test-almalinux:
    runs-on: ubuntu-latest
    container: almalinux:9
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Install Basic Ops
        run: |
          dnf install -y --allowerasing curl sudo procps-ng

      - name: Run Install Script
        run: |
          chmod +x install-almalinux.sh
          # Explicitly pass CI=true through sudo
          sudo CI=true DOCKLIFT_CI_LOCAL=true ./install-almalinux.sh
        env:
          CI: true

      - name: Verify Setup
        run: |
          if [ -d "/opt/docklift" ]; then
            echo "✅ Installation directory exists"
          else
            echo "❌ Installation directory missing"
            exit 1
          fi
          
          if command -v git &> /dev/null; then
            echo "✅ Git was installed"
          else
            echo "❌ Git missing"
            exit 1
          fi
