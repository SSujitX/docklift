name: Test Install - AlmaLinux

on:
  push:
    branches: [ master, main ]
  pull_request:
    branches: [ master, main ]
  workflow_dispatch:

jobs:
  test-almalinux:
    runs-on: ubuntu-latest
    container: almalinux:9
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Install Basic Ops
        run: |
          dnf install -y curl sudo procps-ng

      - name: Run Install Script
        run: |
          chmod +x install.sh
          # Test the script logic. Docker daemon wont start in standard container but 
          # we verify dependencies and code fetching works.
          sudo ./install.sh || echo "Script finished with expected container limitations"
        env:
          CI: true

      - name: Verify Setup
        run: |
          if [ -d "/opt/docklift" ]; then
            echo "✅ Installation directory exists"
          else
            echo "❌ Installation directory missing"
            exit 1
          fi
          
          if command -v git &> /dev/null; then
            echo "✅ Git was installed"
          else
            echo "❌ Git missing"
            exit 1
          fi
